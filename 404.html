<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Redirecting... Magic</title>
    <script>
        // https://colorthoro.github.io/onJS/2
        // https://colorthoro.gitee.io/on-js/I8DPN1
        var paths = location.pathname.split("/");  // pathname: 去除"https:/"之后的部分
        console.log(paths);
        var issueNumber = paths[2]; // ['', 'on-js', 'issueNumber']
        var repohomepage = location.origin + paths.slice(0, -1).join('/');
        lead().catch(err => { window.alert(err); location.replace(repohomepage); });
        async function lead() {
            if (!issueNumber) throw new Error('no issueNumber.');
            let url = await getIssueTitleUrl();
            var FinalUrl = url.replace('[dddcg:ccair14]', await getIP('ccair14'));
            location.replace(FinalUrl);
        }
        async function getIP(name) {
            var jscode = await fetch('./dddcg.js').then(res => res.text());
            var asyncFunc = new Function(`return ${jscode}`);
            var dns = await asyncFunc();
            return dns[name];
        }
        async function getIssueTitleUrl() {
            // https://api.github.com/repos/{owner}/{repo}/issues/
            var ISSUES_LINK = "https://api.github.com/repos/colorthoro/onJS/issues/";
            var queryUrl = ISSUES_LINK + issueNumber;
            var bearer_token = "Bearer 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"
            let payload = await fetch(queryUrl, {
                headers: { 'Authorization': bearer_token }
            }).then(res => res.json());
            var message = payload.message;
            if (message == 'Issue') throw new Error('Issue not found.');
            var title = payload.title;
            var url = encodeURI(title);
            return url;
        }
    </script>
</head>

<body></body>

</html>