<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bilibili Magic</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .flex-wrapper {
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        iframe {
            width: 100%;
            height: 100%;
        }

        .fixed-btn {
            position: fixed;
            top: 80%;
            left: 88%;
            transform: translate(-50%, -50%);
            padding: 10px;
            min-width: 1rem;
            min-height: 1rem;
            line-height: 1rem;
            text-align: center;
            border-radius: 50%;
            color: white;
            background-color: gray;
            user-select: none;
        }

        .transparent {
            opacity: 0.3;
        }

        canvas {
            background: linear-gradient(to bottom, #020111 50%, #20202c 100%);
        }
    </style>
    <!-- <link rel="stylesheet" href="Firework_Simulator-main/style.css"> -->
</head>

<body>
    <div class="flex-wrapper">
        <iframe id="if0" src="" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true">
        </iframe>
        <div id="src-btn" class="fixed-btn transparent">
            <span id="src-text"></span>
            <svg id="svg" style="vertical-align: bottom;" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"
                data-v-029747aa="">
                <path fill="currentColor"
                    d="M764.416 254.72a351.68 351.68 0 0 1 86.336 149.184H960v192.064H850.752a351.68 351.68 0 0 1-86.336 149.312l54.72 94.72-166.272 96-54.592-94.72a352.64 352.64 0 0 1-172.48 0L371.136 936l-166.272-96 54.72-94.72a351.68 351.68 0 0 1-86.336-149.312H64v-192h109.248a351.68 351.68 0 0 1 86.336-149.312L204.8 160l166.208-96h.192l54.656 94.592a352.64 352.64 0 0 1 172.48 0L652.8 64h.128L819.2 160l-54.72 94.72zM704 499.968a192 192 0 1 0-384 0 192 192 0 0 0 384 0z">
                </path>
            </svg>
        </div>
        <div onclick="openBili()" class="fixed-btn transparent" style="top:90%">
            <svg style="vertical-align: bottom;" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"
                data-v-029747aa="">
                <path fill="currentColor"
                    d="m64 448 832-320-128 704-446.08-243.328L832 192 242.816 545.472 64 448zm256 512V657.024L512 768 320 960z">
                </path>
            </svg>
        </div>
    </div>
    <!-- <div id="firework" class="container">
        <div class="loading-init">
            <div class="loading-init__header">
                加载中
            </div>
            <div class="loading-init__status">
                正在装配烟花
            </div>
        </div>
        <div class="stage-container remove">
            <div class="canvas-container">
                <canvas id="trails-canvas">
                </canvas>
                <canvas id="main-canvas">
                </canvas>
            </div>
            <div class="controls">
                <div class="btn pause-btn">
                    <svg fill="white" width="24" height="24">
                        <use href="#icon-pause" xlink:href="#icon-pause">
                        </use>
                    </svg>
                </div>
                <div class="btn sound-btn">
                    <svg fill="white" width="24" height="24">
                        <use href="#icon-sound-off" xlink:href="#icon-sound-off">
                        </use>
                    </svg>
                </div>
                <div class="btn settings-btn">
                    <svg fill="white" width="24" height="24">
                        <use href="#icon-settings" xlink:href="#icon-settings">
                        </use>
                    </svg>
                </div>
            </div>
            <div class="menu hide">
                <div class="menu__inner-wrap">
                    <div class="btn btn--bright close-menu-btn">
                        <svg fill="white" width="24" height="24">
                            <use href="#icon-close" xlink:href="#icon-close">
                            </use>
                        </svg>
                    </div>
                    <div class="menu__header">
                        设置
                    </div>
                    <div class="menu__subheader">
                        若想了解更多信息 请点击任意标签
                    </div>
                    <form>
                        <div class="form-option form-option--select">
                            <label class="shell-type-label">
                                烟花类型
                            </label>
                            <select class="shell-type">
                            </select>
                        </div>
                        <div class="form-option form-option--select">
                            <label class="shell-size-label">
                                烟花大小
                            </label>
                            <select class="shell-size">
                            </select>
                        </div>
                        <div class="form-option form-option--select">
                            <label class="quality-ui-label">
                                画质
                            </label>
                            <select class="quality-ui">
                            </select>
                        </div>
                        <div class="form-option form-option--select">
                            <label class="sky-lighting-label">
                                照亮天空
                            </label>
                            <select class="sky-lighting">
                            </select>
                        </div>
                        <div class="form-option form-option--select">
                            <label class="scaleFactor-label">
                                缩放
                            </label>
                            <select class="scaleFactor">
                            </select>
                        </div>
                        <div class="form-option form-option--checkbox">
                            <label class="auto-launch-label">
                                自动放烟花
                            </label>
                            <input class="auto-launch" type="checkbox" />
                        </div>
                        <div class="form-option form-option--checkbox form-option--finale-mode">
                            <label class="finale-mode-label">
                                同时放更多的烟花
                            </label>
                            <input class="finale-mode" type="checkbox" />
                        </div>
                        <div class="form-option form-option--checkbox">
                            <label class="hide-controls-label">
                                隐藏控制按钮
                            </label>
                            <input class="hide-controls" type="checkbox" />
                        </div>
                        <div class="form-option form-option--checkbox form-option--fullscreen">
                            <label class="fullscreen-label">
                                全屏
                            </label>
                            <input class="fullscreen" type="checkbox" />
                        </div>
                        <div class="form-option form-option--checkbox">
                            <label class="long-exposure-label">
                                保留烟花的火花
                            </label>
                            <input class="long-exposure" type="checkbox" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="help-modal">
            <div class="help-modal__overlay">
            </div>
            <div class="help-modal__dialog">
                <div class="help-modal__header">
                </div>
                <div class="help-modal__body">
                </div>
                <button type="button" class="help-modal__close-btn">
                    关闭
                </button>
            </div>
        </div>
    </div> -->
    <script
        src="https://cdn.bootcdn.net/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script>
    <script>
        function getQueryStringArgs() {
            //取得查询字符串并去掉开头的问号
            var qs = (location.search.length > 0 ? location.search.substring(1) : ""),
                //保存数据的对象
                args = {},
                //取得每一项
                items = qs.length ? qs.split("&") : [],
                item = null,
                name = null,
                value = null,
                //在 for 循环中使用
                i = 0,
                len = items.length;
            //逐个将每一项添加到 args 对象中
            for (i = 0; i < len; i++) {
                item = items[i].split("=");
                name = decodeURIComponent(item[0]);
                value = decodeURIComponent(item[1]);
                if (name.length) {
                    args[name] = value;
                }
            }
            return args;
        }
        let args = getQueryStringArgs();
        console.log(args);
        var bid = args['id'] || 'BV1MU4y1h76r';

        let if0 = document.getElementById("if0");
        function openIframe(url) {
            let oldIframe = document.getElementById("if0");
            let iframe = document.createElement('iframe');
            iframe.setAttribute("id", "if0");
            iframe.setAttribute("scrolling", "no");
            iframe.setAttribute("border", "0");
            iframe.setAttribute("frameborder", "no");
            iframe.setAttribute("framespacing", "0");
            iframe.setAttribute("allowfullscreen", "true");
            iframe.src = url;
            oldIframe.parentNode.insertBefore(iframe, oldIframe);
            if (!!oldIframe) {
                oldIframe.src = "about:blank";
                oldIframe.parentNode.removeChild(oldIframe);
            }
            return document.getElementById("if0");
        }
        src0 = "https://player.bilibili.com/player.html?bvid=" + bid;
        src1 = `https://www.upmso.com/art.php?url=https://www.bilibili.com/video/${bid}/`;
        if0.src = src0;
        let srcBtn = document.getElementById('src-btn');
        let srcText = document.getElementById('src-text');
        let svg = document.getElementById('svg');
        let reo = Cowboy.debounce(1000, () => {
            srcText.innerText = '';
            svg.style.display = 'unset';
        });
        let love = ['I', 'L', 'O', 'V', 'E', 'L', 'G', 'X'], ilove = 0;
        srcBtn.onclick = () => {
            if0 = openIframe(if0.src === src0 ? src1 : src0);
            svg.style.display = 'none';
            srcText.innerText = love[ilove++ % love.length];
            reo();
        }
        let name = args['name'];
        if (bid === 'BV1MU4y1h76r') name = '【4K超清】王菲Faye《矜持》2002日本全面体演唱会现场【国语】';
        if (name) if0.onload = () => document.title = name;
    </script>
    <script>
        function openBili() {
            window.location.href = `https://m.bilibili.com/video/${bid}`;
        }
    </script>
    <script src='./threejs-fireworks/threejs/r77_three.min.js'></script>
    <script src="./threejs-fireworks/src/script.js"></script>
    <!-- <script src='Firework_Simulator-main/js/fscreen.js'></script>
    <script src='Firework_Simulator-main/js/Stage.js'></script>
    <script src='Firework_Simulator-main/js/MyMath.js'></script>
    <script src="Firework_Simulator-main/js/script.js"></script>
    <script>
        store.state.config.finale = true;
        setTimeout(() => {
            store.state.config.autoLaunch = false;
            setTimeout(() => {
                document.getElementById('firework').style.zIndex = -1;
                store.state.soundEnabled = false;
            }, 2000);
        }, 5000);

        document.getElementById('main-canvas').getContext('2d').fillStyle = 'rgba(255, 255, 255, 0)';
        document.getElementById('trails-canvas').getContext('2d').fillStyle = 'rgba(255, 255, 255, 0)';
    </script> -->
</body>

</html>